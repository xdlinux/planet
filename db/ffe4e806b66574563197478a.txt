<blockquote></blockquote><h1><a id="content-ç›®å½•" href="https://blog.lsy223622.com/archives/56/#content-%E7%9B%AE%E5%BD%95" class="heading-permalink" aria-hidden="true" title="Permalink"></a>ç›®å½•</h1>
<ul class="table-of-contents">
<li>
<a href="https://blog.lsy223622.com/archives/56/#content-%E7%9B%AE%E5%BD%95">ç›®å½•</a>
</li>
<li>
<a href="https://blog.lsy223622.com/archives/56/#content-%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2">å†™åœ¨å‰é¢</a>
</li>
<li>
<a href="https://blog.lsy223622.com/archives/56/#content-%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B">é¡¹ç›®ç®€ä»‹</a>
</li>
<li>
<a href="https://blog.lsy223622.com/archives/56/#content-%E9%A1%B9%E7%9B%AE%E5%9C%B0%E5%9D%80">é¡¹ç›®åœ°å€</a>
</li>
<li>
<a href="https://blog.lsy223622.com/archives/56/#content-%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B">å¼€å‘è¿‡ç¨‹</a>
<ul>
<li>
<a href="https://blog.lsy223622.com/archives/56/#content-%E5%BC%80%E5%A7%8B%E6%98%AF%E6%80%8E%E4%B9%88%E6%83%B3%E5%88%B0%E5%81%9A%E8%BF%99%E4%B8%AA%E7%9A%84%E5%91%A2">å¼€å§‹æ˜¯æ€ä¹ˆæƒ³åˆ°åšè¿™ä¸ªçš„å‘¢ï¼Ÿ</a>
</li>
<li>
<a href="https://blog.lsy223622.com/archives/56/#content-%E5%BC%80%E5%B9%B2%E8%B6%85%E7%BA%A7%E6%B5%81%E6%B0%B4%E8%B4%A6%E7%8E%AF%E8%8A%82">å¼€å¹²ï¼ï¼ˆè¶…çº§æµæ°´è´¦ç¯èŠ‚ï¼ï¼‰</a>
</li>
</ul>
</li>
<li>
<a href="https://blog.lsy223622.com/archives/56/#content-%E4%BD%BF%E7%94%A8%E6%BC%94%E7%A4%BA">ä½¿ç”¨æ¼”ç¤º</a>
</li>
<li>
<a href="https://blog.lsy223622.com/archives/56/#content-%E5%86%99%E5%9C%A8%E5%90%8E%E9%9D%A2">å†™åœ¨åé¢</a>
</li>
</ul>
<h1><a id="content-å†™åœ¨å‰é¢" href="https://blog.lsy223622.com/archives/56/#content-%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2" class="heading-permalink" aria-hidden="true" title="Permalink"></a>å†™åœ¨å‰é¢</h1>
<ul>
<li>å…¶å®æ˜¯å‰æ®µæ—¶é—´å†™çš„ç¨‹åºäº†ï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰åœ¨åšå®¢ä¸Šè®°å½•ä¸‹æ¥ï¼Œç°åœ¨ç»ˆäºæƒ³èµ·æ¥äº†å°±å†™ä¸€ä¸‹ã€‚</li>
<li>æœ¬æ–‡ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹è¿™ä¸ªç¨‹åºçš„å¼€å‘è¿‡ç¨‹ã€‚</li>
<li>
<del>çº¯çº¯æµæ°´è´¦æ²¡å•¥å¥½çœ‹çš„æ</del>
</li>
</ul>
<h1><a id="content-é¡¹ç›®ç®€ä»‹" href="https://blog.lsy223622.com/archives/56/#content-%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B" class="heading-permalink" aria-hidden="true" title="Permalink"></a>é¡¹ç›®ç®€ä»‹</h1>
<p><a rel="noopener noreferrer" href="https://github.com/lsy223622/XDUClassVideoDownloader/tags"><img src="https://img.shields.io/github/v/tag/lsy223622/XDUClassVideoDownloader" alt="GitHub Tag" loading="lazy"/></a>
<a rel="noopener noreferrer" href="https://github.com/lsy223622/XDUClassVideoDownloader/releases/latest"><img src="https://img.shields.io/github/release-date-pre/lsy223622/XDUClassVideoDownloader" alt="GitHub Release Date" loading="lazy"/></a>
<a rel="noopener noreferrer" href="https://github.com/lsy223622/XDUClassVideoDownloader/releases"><img src="https://img.shields.io/github/downloads/lsy223622/XDUClassVideoDownloader/total" alt="GitHub Downloads (all assets, all releases)" loading="lazy"/></a>
<a rel="noopener noreferrer" href="https://github.com/lsy223622/XDUClassVideoDownloader/stargazers"><img src="https://img.shields.io/github/stars/lsy223622/XDUClassVideoDownloader" alt="GitHub Repo stars" loading="lazy"/></a></p>
<ul>
<li>
<p>æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªç”¨äºä¸‹è½½è¥¿å®‰ç”µå­ç§‘æŠ€å¤§å­¦å½•ç›´æ’­å¹³å°è¯¾ç¨‹è§†é¢‘çš„å·¥å…·ã€‚</p>
</li>
<li>
<p>åªéœ€è¾“å…¥ä»»æ„ä¸€èŠ‚è¯¾çš„ <code>liveId</code>ï¼Œå³å¯è‡ªåŠ¨ä¸‹è½½ <code>å•èŠ‚è¯¾</code> / <code>å•é›†ï¼ˆåŠèŠ‚è¯¾ï¼‰</code> / <code>è¯¥è¯¾ç¨‹çš„æ‰€æœ‰è§†é¢‘</code>ã€‚</p>
<blockquote>
<p><code>liveId</code> æ˜¯è¯¾ç¨‹ç›´æ’­çš„å”¯ä¸€æ ‡è¯†ï¼Œå¯ä»¥åœ¨è¯¾ç¨‹ç›´æ’­é¡µé¢çš„ URL ä¸­æ‰¾åˆ°ã€‚å¦‚ï¼š<code>http://newesxidian.chaoxing.com/live/viewNewCourseLive1?liveId=12345678</code> ä¸­çš„ <code>12345678</code>ã€‚</p>
</blockquote>
</li>
<li>
<p>åŒæ—¶ä¼šä¿å­˜é€‰æ‹©ä¸‹è½½çš„èŒƒå›´å†…æ‰€æœ‰è§†é¢‘çš„ m3u8 é“¾æ¥åˆ°å¯¹åº”çš„ <code>csv</code> è¡¨æ ¼ä¸­ï¼Œæ–¹ä¾¿ä½¿ç”¨å…¶ä»–æ–¹å¼ä¸‹è½½ã€‚</p>
</li>
<li>
<p>ä¸‹è½½æ—¶ä¼šè‡ªåŠ¨æ£€æŸ¥ä¹‹å‰æ˜¯å¦ä¸‹è½½è¿‡åŒä¸€èŠ‚è¯¾ï¼Œå¦‚æœå·²ç»ä¸‹è½½åˆ™ä¼šè·³è¿‡ã€‚æ‰€ä»¥å¯ä»¥åœ¨ä¸€å­¦æœŸä¸­çš„å¤šä¸ªæ—¶å€™éšæ—¶ä¸‹è½½æ–°å¢çš„å½•æ’­è§†é¢‘ã€‚</p>
</li>
<li>
<p>ä¸‹è½½çš„è§†é¢‘æŒ‰ç…§è¯¾ç¨‹å’Œæ—¶é—´æ•´ç†ï¼Œä¸‹è½½å¤šä¸ªè¯¾ç¨‹çš„è§†é¢‘ä¹Ÿä¸ä¼šå†²çªã€‚</p>
</li>
<li>
<p>æ–‡ä»¶å¤¹å’Œ <code>csv</code> è¡¨æ ¼å‘½åè§„åˆ™ï¼šå¹´ä»½-è¯¾ç¨‹å·-è¯¾ç¨‹åã€‚</p>
</li>
<li>
<p>è¯¾ç¨‹è§†é¢‘å‘½åè§„åˆ™ï¼šè¯¾ç¨‹å·-è¯¾ç¨‹å-å¹´æœˆæ—¥-å‘¨æ¬¡-èŠ‚å·-è§†é¢‘æ¥æºã€‚ã€</p>
</li>
</ul>
<h1><a id="content-é¡¹ç›®åœ°å€" href="https://blog.lsy223622.com/archives/56/#content-%E9%A1%B9%E7%9B%AE%E5%9C%B0%E5%9D%80" class="heading-permalink" aria-hidden="true" title="Permalink"></a>é¡¹ç›®åœ°å€</h1>
<ul>
<li>
<a rel="noopener noreferrer" href="https://github.com/lsy223622/XDUClassVideoDownloader">lsy223622/XDUClassVideoDownloader</a>
</li>
<li>é¡¹ç›®ä»‹ç»ã€ä½¿ç”¨æ–¹æ³•ã€æºä»£ç å’Œæ‰“åŒ…ç¨‹åºéƒ½åœ¨ä¸Šé¢é“¾æ¥é‡Œï¼Œè¿™é‡Œå°±ä¸é‡å¤äº†å“¦~</li>
</ul>
<h1><a id="content-å¼€å‘è¿‡ç¨‹" href="https://blog.lsy223622.com/archives/56/#content-%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B" class="heading-permalink" aria-hidden="true" title="Permalink"></a>å¼€å‘è¿‡ç¨‹</h1>
<h2><a id="content-å¼€å§‹æ˜¯æ€ä¹ˆæƒ³åˆ°åšè¿™ä¸ªçš„å‘¢" href="https://blog.lsy223622.com/archives/56/#content-%E5%BC%80%E5%A7%8B%E6%98%AF%E6%80%8E%E4%B9%88%E6%83%B3%E5%88%B0%E5%81%9A%E8%BF%99%E4%B8%AA%E7%9A%84%E5%91%A2" class="heading-permalink" aria-hidden="true" title="Permalink"></a>å¼€å§‹æ˜¯æ€ä¹ˆæƒ³åˆ°åšè¿™ä¸ªçš„å‘¢ï¼Ÿ</h2>
<ul>
<li>æœŸæœ«å¤ä¹ çš„æ—¶å€™ï¼Œå‘ç°å­¦æ ¡çš„å½•ç›´æ’­å¹³å°ä¸Šæœ‰å¾ˆå¤šè¯¾ç¨‹çš„å½•æ’­è§†é¢‘ï¼Œä½†æ˜¯æ²¡æœ‰ä¸‹è½½çš„æŒ‰é’®ï¼Œåªèƒ½åœ¨çº¿è§‚çœ‹ã€‚</li>
<li>ä½†æ˜¯åœ¨çº¿è§‚çœ‹çš„æ—¶å€™ç»å¸¸ä¼šå¡é¡¿ï¼Œè€Œä¸”æœ‰æ—¶å€™éœ€è¦åå¤è§‚çœ‹ï¼Œæ‰€ä»¥æƒ³ç€èƒ½ä¸èƒ½ä¸‹è½½ä¸‹æ¥çœ‹ã€‚</li>
<li>å¼€å§‹æƒ³åˆ°äº† IDM çš„è§†é¢‘ä¸‹è½½åŠŸèƒ½ï¼Œä½†æ˜¯ä½“éªŒçœŸä¸ç®—å¥½ï¼š
<ul>
<li>é¦–å…ˆéœ€è¦æ‰“å¼€æ¯ä¸ªè§†é¢‘çš„æ’­æ”¾é¡µé¢ï¼Œç­‰å¾…æ¼«é•¿çš„åŠ è½½æ—¶é—´ï¼ŒIDM æ‰èƒ½æ£€æµ‹åˆ°è§†é¢‘ã€‚</li>
<li>ç„¶åè¦åœ¨æ¯ä¸ªè§†é¢‘çš„è§’è½é‡Œä¸€ä¸ªä¸€ä¸ªç‚¹ç”¨ IDM ä¸‹è½½ï¼Œä¸‹å®Œæ‰€æœ‰è§†é¢‘å¾—ç´¯æ­»ã€‚</li>
<li>è€Œä¸”ä¸‹è½½çš„è§†é¢‘æ–‡ä»¶åä¹Ÿæ˜¯éšæœºçš„ä¸€ä¸²æ•°å­—ï¼Œéœ€è¦æ‰‹åŠ¨æ•´ç†ã€‚</li>
</ul>
</li>
<li>ç¢°å·§çœ‹åˆ°ç¾¤å‹æåˆ°å½•ç›´æ’­å¹³å°æœ‰èƒ½è·å–ä¸€èŠ‚è¯¾æ‰€æœ‰è§†é¢‘é“¾æ¥çš„æ¥å£ï¼Œäºæ˜¯å°±æƒ³ç€èƒ½ä¸èƒ½å†™ä¸€ä¸ªè„šæœ¬æ¥æ‰¹é‡ä¸‹è½½è§†é¢‘ã€‚</li>
</ul>
<h2><a id="content-å¼€å¹²è¶…çº§æµæ°´è´¦ç¯èŠ‚" href="https://blog.lsy223622.com/archives/56/#content-%E5%BC%80%E5%B9%B2%E8%B6%85%E7%BA%A7%E6%B5%81%E6%B0%B4%E8%B4%A6%E7%8E%AF%E8%8A%82" class="heading-permalink" aria-hidden="true" title="Permalink"></a>å¼€å¹²ï¼ï¼ˆè¶…çº§æµæ°´è´¦ç¯èŠ‚ï¼ï¼‰</h2>
<ul>
<li>
<p>æ ¹æ®ç¾¤å‹æä¾›çš„é“¾æ¥ï¼Œä½¿ç”¨ <code>Curl</code> å°è¯•äº†ä¸€ä¸‹ï¼Œç¡®å®èƒ½å¾—åˆ°æ‰€æœ‰è§†é¢‘é“¾æ¥ã€‚</p>
<ul>
<li>è¿™ä¸ªé“¾æ¥èƒ½ä½¿ç”¨ä¸€èŠ‚è¯¾çš„ <code>liveId</code> è·å–åˆ°è¿™é—¨è¯¾æ‰€æœ‰è§†é¢‘çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¯¾ç¨‹å·ã€è¯¾ç¨‹åç§°ã€æ•™å¸ˆåç§°ã€ä¸Šè¯¾æ•™å®¤ã€ä¸Šè¯¾æ—¶é—´ã€<code>liveId</code> ç­‰ä¿¡æ¯ï¼Œç¾¤å‹æä¾›çš„é“¾æ¥å‚æ•°éå¸¸å¤æ‚ï¼Œæˆ‘ç­›é€‰æµ‹è¯•ä¹‹åå‘ç°åªä¿ç•™ä»¥ä¸‹å‚æ•°å°±èƒ½å·¥ä½œï¼š
<ul>
<li>æ¥å£é“¾æ¥ï¼š<code>http://newesxidian.chaoxing.com/live/listSignleCourse</code>ï¼ˆ<code>Single</code> æ‹¼æˆäº† <code>Signle</code>ï¼Œç¨‹åºå‘˜æ‰£å¤§åˆ†ï¼‰</li>
<li>URL å‚æ•°ï¼š<code>liveId=12345678</code>ï¼ˆéšä¾¿ä¸€èŠ‚è¯¾å°±è¡Œï¼Œä¸ä¸€å®šè¦ç¬¬ä¸€èŠ‚è¯¾ï¼‰</li>
<li>User-Agent: <code>Mozilla/5.0</code>ï¼ˆUA æ„Ÿè§‰æ˜¯é»‘åå•åˆ¶åº¦ï¼Œ<code>curl</code> ä¸å®šä¹‰ UA èƒ½æ­£å¸¸å·¥ä½œï¼Œä½† Python çš„ <code>requests</code> å°±ä¸è¡Œï¼Œæ‰€ä»¥æˆ‘å°±éšä¾¿å¡«äº†è¿™ä¸ªï¼Œèƒ½ç”¨å°±è¡Œï¼‰</li>
<li>Cookie: <code>UID=2</code>ï¼ˆéç©ºå°±è¡Œï¼Œéšä¾¿ç»™ä¸ªæ•°å­—ï¼Œè¿™é‰´æƒå¤ªè‰ç‡äº†å§ï¼‰</li>
</ul>
</li>
<li>è¿™ä¸ªé“¾æ¥èƒ½ä½¿ç”¨ä¸€èŠ‚è¯¾çš„ <code>liveId</code> è·å–åˆ°è¿™èŠ‚è¯¾çš„å½•æ’­æŸ¥çœ‹é¡µé¢é“¾æ¥ï¼Œè¿”å›é“¾æ¥çš„ URL å‚æ•°æ˜¯ä¸€æ®µ URL ç¼–ç åçš„ Jsonï¼Œè§£ç åèƒ½å¾—åˆ°ä¸‰ä¸ªè§†é¢‘çš„ m3u8 é“¾æ¥ï¼ŒåŒ…æ‹¬ <code>pptVideo</code> <code>teacherTrack</code> <code>studentFull</code>ï¼Œåˆ†åˆ«æ˜¯æŠ•å½±ä»ªç”»é¢ã€æ•™å¸ˆç”»é¢ï¼ˆè‡ªåŠ¨è¿½è¸ªï¼‰å’Œæ•™å®¤å­¦ç”Ÿç”»é¢ï¼ˆé»‘æ¿å·¦ä¸Šè§’çš„æ‘„åƒå¤´å¯¹ç€æ•´ä¸ªæ•™å®¤æ‹ï¼Œä½†è¿™ä¸ªè§†é¢‘ä¸‹è½½ä¸‹æ¥å¤§å¤šæ˜¯ç ´ç¢çš„ï¼Œä¹Ÿæ²¡å•¥ç”¨ï¼Œç½‘é¡µä¸Šæ’­æ”¾çš„æ—¶å€™æ˜¯éšè—çš„ï¼‰ã€‚åŒæ ·æ˜¯ç­›é€‰æ¸…ç†ä¹‹åçš„å‚æ•°ï¼š
<ul>
<li>æ¥å£é“¾æ¥ï¼š<code>http://newesxidian.chaoxing.com/live/getViewUrlHls</code>
</li>
<li>URL å‚æ•°ï¼š<code>liveId=12345678&amp;status=2</code>ï¼ˆ<code>status=2</code> å¥½åƒæ˜¯éœ€è¦çš„ï¼Œä½†æˆ‘å¿˜è®°ä¸ºä»€ä¹ˆäº†ï¼‰</li>
<li>User-Agent: <code>Mozilla/5.0</code>ï¼ˆåŒä¸Šï¼‰</li>
<li>Cookie: <code>UID=2</code>ï¼ˆåŒä¸Šï¼‰</li>
</ul>
</li>
</ul>
</li>
<li>
<p>ç„¶åæˆ‘ç›´æ¥æŠŠè¿™ä¸€å †è¯·æ±‚ã€è¿”å›å€¼ã€è§£æå¤„ç†çš„é€»è¾‘å‘ç»™ ChatGPTï¼Œè®©å®ƒå®ç°è·å–ä¸€é—¨è¯¾æ‰€æœ‰è§†é¢‘çš„ m3u8 é“¾æ¥å’Œæ—¶é—´ç­‰ä¿¡æ¯å¹¶ä¿å­˜åˆ°ä¸€ä¸ª <code>csv</code> è¡¨æ ¼é‡Œçš„åŠŸèƒ½ã€‚å¤šäºäº† GPT-4oï¼Œç»™æˆ‘æä¾›äº†ä¸€æ®µéå¸¸å®Œç¾çš„ Python ä»£ç ã€‚</p>
  <details>
  <summary>å±•å¼€æŸ¥çœ‹ ChatGPT ç»™å‡ºçš„ä»£ç ï¼ˆé‚£æ—¶å€™è¯·æ±‚å‚æ•°è¿˜æ²¡æ¸…ç†ï¼‰</summary>
<pre><code class="language-python">import subprocess
import json
import csv
import urllib.parse

def get_initial_data():
    curl_command = [
        &#34;curl&#34;, &#34;http://newesxidian.chaoxing.com/live/listSignleCourse&#34;,
        &#34;--compressed&#34;,
        &#34;-X&#34;, &#34;POST&#34;,
        &#34;-H&#34;, &#34;User-Agent: Mozilla/5.0 (Wayland; Linux x86_64; rv:120.1) Gecko/20100101 Firefox/120.1&#34;,
        &#34;-H&#34;, &#34;Accept: application/json, text/javascript, */*; q=0.01&#34;,
        &#34;-H&#34;, &#34;Accept-Language: en-US,en;q=0.7,ja;q=0.3&#34;,
        &#34;-H&#34;, &#34;Accept-Encoding: gzip, deflate&#34;,
        &#34;-H&#34;, &#34;Content-Type: application/x-www-form-urlencoded; charset=UTF-8&#34;,
        &#34;-H&#34;, &#34;X-Requested-With: XMLHttpRequest&#34;,
        &#34;-H&#34;, &#34;Origin: http://newesxidian.chaoxing.com&#34;,
        &#34;-H&#34;, &#34;DNT: 1&#34;,
        &#34;-H&#34;, &#34;Sec-GPC: 1&#34;,
        &#34;-H&#34;, &#34;Connection: keep-alive&#34;,
        &#34;-H&#34;, &#34;Referer: http://newesxidian.chaoxing.com/live/viewNewCourseLive1?isStudent=1&#34;,
        &#34;-H&#34;, &#34;Cookie: UID=9876&#34;,
        &#34;--data-raw&#34;, &#34;liveId=11740668&#34;
    ]

    result = subprocess.run(curl_command, capture_output=True, text=True)
    return json.loads(result.stdout)

def get_m3u8_links(live_id):
    curl_command = [
        &#34;curl&#34;, f&#34;http://newesxidian.chaoxing.com/live/getViewUrlHls?liveId={live_id}&amp;status=2&amp;jie=&amp;isStudent=&#34;,
        &#34;--compressed&#34;,
        &#34;-H&#34;, &#34;User-Agent: Mozilla/5.0&#34;,
        &#34;-H&#34;, &#34;Accept: */*&#34;,
        &#34;-H&#34;, &#34;Accept-Language: en-US,en;q=0.7,ja;q=0.3&#34;,
        &#34;-H&#34;, &#34;Accept-Encoding: gzip, deflate&#34;,
        &#34;-H&#34;, &#34;X-Requested-With: XMLHttpRequest&#34;,
        &#34;-H&#34;, &#34;DNT: 1&#34;,
        &#34;-H&#34;, &#34;Sec-GPC: 1&#34;,
        &#34;-H&#34;, &#34;Connection: keep-alive&#34;,
        &#34;-H&#34;, &#34;Referer: http://newesxidian.chaoxing.com/live/viewNewCourseLive1?isStudent=1&#34;,
        &#34;-H&#34;, &#34;Cookie: UID=2&#34;
    ]

    result = subprocess.run(curl_command, capture_output=True, text=True)
    response = result.stdout

    url_start = response.find(&#39;info=&#39;)
    if url_start == -1:
        raise ValueError(&#34;info parameter not found in the response&#34;)

    encoded_info = response[url_start + 5:]
    decoded_info = urllib.parse.unquote(encoded_info)
    info_json = json.loads(decoded_info)

    video_paths = info_json.get(&#39;videoPath&#39;, {})
    ppt_video = video_paths.get(&#39;pptVideo&#39;, &#39;&#39;)
    teacher_track = video_paths.get(&#39;teacherTrack&#39;, &#39;&#39;)
    student_full = video_paths.get(&#39;studentFull&#39;, &#39;&#39;)

    return ppt_video, teacher_track, student_full

def main():
    data = get_initial_data()

    rows = []
    for entry in data:
        live_id = entry[&#34;id&#34;]
        month = entry[&#34;startTime&#34;][&#34;month&#34;]
        date = entry[&#34;startTime&#34;][&#34;date&#34;]
        day = entry[&#34;startTime&#34;][&#34;day&#34;]
        jie = entry[&#34;jie&#34;]
        days = entry[&#34;days&#34;]

        ppt_video, teacher_track, student_full = get_m3u8_links(live_id)

        row = [month, date, day, jie, days, ppt_video, teacher_track, student_full]
        rows.append(row)

    with open(&#39;m3u8.csv&#39;, mode=&#39;w&#39;, newline=&#39;&#39;) as file:
        writer = csv.writer(file)
        writer.writerow([&#39;month&#39;, &#39;date&#39;, &#39;day&#39;, &#39;jie&#39;, &#39;days&#39;, &#39;pptVideo&#39;, &#39;teacherTrack&#39;, &#39;studentFull&#39;])
        writer.writerows(rows)

    print(&#34;m3u8.csv æ–‡ä»¶å·²åˆ›å»ºå¹¶å†™å…¥æ•°æ®ã€‚&#34;)

if __name__ == &#34;__main__&#34;:
    main()
</code></pre>
  </details>
</li>
<li>
<p>æˆ‘ä¹‹å‰å¹¶æ²¡æœ‰å†™è¿‡ Python ç¨‹åºï¼Œäºæ˜¯æŒ‰ç…§ä¹ æƒ¯è®© ChatGPT åœ¨ Python ä¸­è°ƒç”¨ <code>Curl</code> å‘½ä»¤è¡Œã€‚ä¹‹åç»ç¾¤å‹æé†’æ¢æˆäº† Python çš„ <code>requests</code> åº“ï¼Œè¿™æ ·ä»£ç æ›´ç®€æ´ï¼Œæ— éœ€è°ƒç”¨å¤–éƒ¨ç¨‹åºã€‚</p>
  <details>
  <summary>å±•å¼€æŸ¥çœ‹æ”¹ç”¨ requests åº“çš„ç¬¬ä¸€æ®µè¯·æ±‚ä»£ç </summary>
<pre><code class="language-python">def get_initial_data():
url = &#34;http://newesxidian.chaoxing.com/live/listSignleCourse&#34;
headers = {
    &#34;User-Agent&#34;: &#34;Mozilla/5.0 (Wayland; Linux x86_64; rv:120.1) Gecko/20100101 Firefox/120.1&#34;,
    &#34;Accept&#34;: &#34;application/json, text/javascript, */*; q=0.01&#34;,
    &#34;Accept-Language&#34;: &#34;en-US,en;q=0.7,ja;q=0.3&#34;,
    &#34;Accept-Encoding&#34;: &#34;gzip, deflate&#34;,
    &#34;Content-Type&#34;: &#34;application/x-www-form-urlencoded; charset=UTF-8&#34;,
    &#34;X-Requested-With&#34;: &#34;XMLHttpRequest&#34;,
    &#34;Origin&#34;: &#34;http://newesxidian.chaoxing.com&#34;,
    &#34;DNT&#34;: &#34;1&#34;,
    &#34;Sec-GPC&#34;: &#34;1&#34;,
    &#34;Connection&#34;: &#34;keep-alive&#34;,
    &#34;Referer&#34;: &#34;http://newesxidian.chaoxing.com/live/viewNewCourseLive1?isStudent=1&#34;,
    &#34;Cookie&#34;: &#34;UID=9876&#34;
}
data = {
    &#34;liveId&#34;: &#34;11740668&#34;
}

response = requests.post(url, headers=headers, data=data)
response.raise_for_status()
return response.json()
</code></pre>
  </details>
</li>
<li>
<p>ç¨‹åºä¸€åŠ¨ä¸åŠ¨åœ°åœ¨é‚£é‡Œé»˜é»˜å¹²æ´»è‚¯å®šä¸è¡Œï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦çŸ¥é“å®ƒæœ‰æ²¡æœ‰æ­»ï¼Œäºæ˜¯ä½¿ç”¨ <code>tqdm</code> åŠ äº†ä¸€ä¸ªè¿›åº¦æ¡ã€‚</p>
  <details>
  <summary>å±•å¼€æŸ¥çœ‹ä½¿ç”¨ tqdm çš„ä»£ç </summary>
<pre><code class="language-python">for entry in tqdm(data, desc=&#34;Processing entries&#34;):
    live_id = entry[&#34;id&#34;]
    month = entry[&#34;startTime&#34;][&#34;month&#34;]
    date = entry[&#34;startTime&#34;][&#34;date&#34;]
    day = entry[&#34;startTime&#34;][&#34;day&#34;]
    jie = entry[&#34;jie&#34;]
    days = entry[&#34;days&#34;]

    ppt_video, teacher_track, student_full = get_m3u8_links(live_id)

    row = [month, date, day, jie, days, ppt_video, teacher_track, student_full]
    rows.append(row)
</code></pre>
  </details>
</li>
<li>
<p>è·å–åˆ° m3u8 é“¾æ¥ä¹‹åï¼Œå°±å¯ä»¥è®©å®ƒè°ƒç”¨ä¸‹è½½ç¨‹åºä¸‹è½½è§†é¢‘äº†ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨äº† <a rel="noopener noreferrer" href="https://github.com/nilaoda/N_m3u8DL-RE">N_m3u8DL-RE</a>ï¼Œå› ä¸º m3u8 æ˜¯ä¸€ç§ç´¢å¼•æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«äº†è§†é¢‘çš„åˆ†æ®µé“¾æ¥ï¼Œ<code>N_m3u8DL-RE</code> å¯ä»¥è‡ªåŠ¨ä¸‹è½½å¹¶åˆå¹¶è¿™äº›åˆ†æ®µè§†é¢‘ã€‚</p>
  <details>
  <summary>å±•å¼€æŸ¥çœ‹ä½¿ç”¨ subprocess è°ƒç”¨ N_m3u8DL-RE çš„ä»£ç </summary>
<pre><code class="language-python">command = f&#39;N_m3u8DL-RE.exe &#34;{url}&#34; --save-dir &#34;m3u8&#34; --save-name &#34;{filename}&#34;&#39;
subprocess.run(command, shell=True, check=True)
</code></pre>
  </details>
</li>
<li>
<p>ä¸ºäº†è®©æ–‡ä»¶åä¿¡æ¯ä¸°å¯Œæ˜“äºæ•´ç†ï¼ŒæŒ‰ç…§â€œcourseCodecourseNamexå¹´xæœˆxæ—¥ç¬¬dayså‘¨æ˜ŸæœŸdayç¬¬jieèŠ‚-pptVideo/teacherTrackâ€çš„æ ¼å¼å‘½åï¼Œæ˜ŸæœŸå‡ è½¬æ¢æˆæ›´åŠ ç¬¦åˆä¹ æƒ¯çš„æ±‰å­—ã€‚</p>
  <details>
  <summary>å±•å¼€æŸ¥çœ‹æ–‡ä»¶åå‘½åä»£ç </summary>
<pre><code class="language-python">def day_to_chinese(day):
    days = [&#34;æ—¥&#34;, &#34;ä¸€&#34;, &#34;äºŒ&#34;, &#34;ä¸‰&#34;, &#34;å››&#34;, &#34;äº”&#34;, &#34;å…­&#34;]
    return days[day]

for row in tqdm(rows, desc=&#34;Downloading videos&#34;):
    month, date, day, jie, days, ppt_video, teacher_track, student_full = row
    day_chinese = day_to_chinese(day)

    if ppt_video:
        filename = f&#34;{course_code}{course_name}{year}å¹´{month1}æœˆ{date1}æ—¥ç¬¬{days1}å‘¨æ˜ŸæœŸ{day_chinese1}ç¬¬{jie1}èŠ‚-pptVideo&#34;
        download_m3u8(ppt_video, filename)

    if teacher_track:
        filename = f&#34;{course_code}{course_name}{year}å¹´{month1}æœˆ{date1}æ—¥ç¬¬{days1}å‘¨æ˜ŸæœŸ{day_chinese1}ç¬¬{jie1}èŠ‚-teacherTrack&#34;
        download_m3u8(teacher_track, filename)
</code></pre>
  </details>
</li>
<li>
<p>æ¥å£æä¾›çš„ä¿¡æ¯æ²¡æœ‰å¹´ä»½ï¼Œå€’æ˜¯æœ‰æ—¶é—´æˆ³ã€‚å¦‚æœæ˜¯é‡ä¿®çš„è¯ä¸€é—¨è¯¾å°±ä¼šä¸Šä¸æ­¢ä¸€æ¬¡ï¼Œä¸ºäº†å¯ä»¥æ”¶è—ä¸åŒå­¦å¹´çš„åŒä¸€èŠ‚è¯¾ï¼Œæ”¹æˆç”¨æ—¶é—´æˆ³è½¬æ¢å¾—åˆ°å¹´æœˆæ—¥ã€‚</p>
  <details>
  <summary>å±•å¼€æŸ¥çœ‹æ—¶é—´æˆ³è½¬æ¢ä»£ç </summary>
<pre><code class="language-python">start_time_unix = start_time / 1000
start_time_struct = time.gmtime(start_time_unix)
month = start_time_struct.tm_mon
date = start_time_struct.tm_mday
</code></pre>
  </details>
</li>
<li>
<p>åˆ¤æ–­æ˜¯å¦å­˜åœ¨å·²ç»ä¸‹è½½çš„è§†é¢‘ï¼Œå­˜åœ¨å°±è·³è¿‡ä¸‹è½½ã€‚</p>
  <details>
  <summary>å±•å¼€æŸ¥çœ‹æ›´æ–°åçš„ä»£ç </summary>
<pre><code class="language-python">for row in tqdm(rows, desc=&#34;Downloading videos&#34;):
    month, date, day, jie, days, ppt_video, teacher_track = row
    day_chinese = day_to_chinese(day)

    if ppt_video:
        filename = f&#34;{course_code}{course_name}{year}å¹´{month}æœˆ{date}æ—¥ç¬¬{days}å‘¨æ˜ŸæœŸ{day_chinese}ç¬¬{jie}èŠ‚-pptVideo&#34;
        filepath = os.path.join(save_dir, f&#34;{filename}.ts&#34;)
        if os.path.exists(filepath):
            print(f&#34;{filepath} å·²å­˜åœ¨ï¼Œè·³è¿‡ä¸‹è½½ã€‚&#34;)
        else:
            download_m3u8(ppt_video, filename, save_dir)

    if teacher_track:
        filename = f&#34;{course_code}{course_name}{year}å¹´{month}æœˆ{date}æ—¥ç¬¬{days}å‘¨æ˜ŸæœŸ{day_chinese}ç¬¬{jie}èŠ‚-teacherTrack&#34;
        filepath = os.path.join(save_dir, f&#34;{filename}.ts&#34;)
        if os.path.exists(filepath):
            print(f&#34;{filepath} å·²å­˜åœ¨ï¼Œè·³è¿‡ä¸‹è½½ã€‚&#34;)
        else:
            download_m3u8(teacher_track, filename, save_dir)
</code></pre>
  </details>
</li>
<li>
<p>æ„Ÿè°¢ç¾¤å‹ <a rel="noopener noreferrer" href="https://github.com/chitao1234">chi(Waylandhater</a> æå‡ºçš„æ·»åŠ å‘½ä»¤è¡Œä½¿ç”¨æ–¹æ³•å’Œå•ä¸ªè§†é¢‘ä¸‹è½½æ¨¡å¼ï¼Œå¹¶ä¸”ååˆ†è´´å¿ƒåœ°å‘äº† pull requestï¼Œç›´æ¥å¸®æˆ‘æå®šäº†ã€‚</p>
  <details>
  <summary>å±•å¼€æŸ¥çœ‹æ·»åŠ å‘½ä»¤è¡Œä½¿ç”¨æ–¹æ³•çš„ä»£ç </summary>
<pre><code class="language-python">from argparse import ArgumentParser

def main(liveid_from_cli=None, command=&#39;&#39;):
while True:
    if liveid_from_cli:
        input_live_id = liveid_from_cli
        liveid_from_cli = None
    else:
        input_live_id = input(&#34;è¯·è¾“å…¥ liveIdï¼š&#34;)
......

def parse_arguments():
    parser = ArgumentParser(description=&#39;ç”¨äºä¸‹è½½è¥¿å®‰ç”µå­ç§‘æŠ€å¤§å­¦å½•ç›´æ’­å¹³å°è¯¾ç¨‹è§†é¢‘çš„å·¥å…·&#39;)
    parser.add_argument(&#39;liveid&#39;, nargs=&#39;?&#39;, default=None, help=&#39;ç›´æ’­IDï¼Œä¸è¾“å…¥åˆ™é‡‡ç”¨äº¤äº’å¼æ–¹å¼è·å–&#39;)
    parser.add_argument(&#39;-c&#39;, &#39;--command&#39;, default=&#39;&#39;, help=&#39;è‡ªå®šä¹‰ä¸‹è½½å‘½ä»¤ï¼Œä½¿ç”¨ {url}, {save_dir}, {filename} ä½œä¸ºæ›¿æ¢æ ‡è®°&#39;)

    args = parser.parse_args()
    return args

if __name__ == &#34;__main__&#34;:
    args = parse_arguments()
    main(liveid_from_cli=args.liveid, command=args.command)
</code></pre>
  </details>
  <details>
  <summary>å±•å¼€æŸ¥çœ‹æ·»åŠ å•ä¸ªè§†é¢‘ä¸‹è½½æ¨¡å¼çš„ä»£ç </summary>
<pre><code class="language-python">def main(liveid_from_cli=None, command=&#39;&#39;, single=False):
while True:
    if liveid_from_cli:
        input_live_id = liveid_from_cli
......

for entry in tqdm(data, desc=&#34;Processing entries&#34;):
    live_id = entry[&#34;id&#34;]
    if single and str(live_id) != input_live_id:
        continue
......

    parser.add_argument(&#39;-s&#39;, &#39;--single&#39;, default=False, action=&#39;store_true&#39;, help=&#39;ä»…ä¸‹è½½å•é›†è§†é¢‘&#39;)
......

if __name__ == &#34;__main__&#34;:
args = parse_arguments()
main(liveid_from_cli=args.liveid, command=args.command, single=args.single)
</code></pre>
  </details>
</li>
<li>
<p>ç¾¤å‹è¯´ä»£ç å¼€å¤´è¦åŠ ä¸€è¡Œ shebangï¼Œæˆ‘å°±åŠ äº†ä¸€è¡Œ shebangã€‚è¿™ shebang æœ‰å•¥ç”¨å‘¢ï¼Ÿæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œä½†ç½‘ä¸Šä¸€æœè¯´æ˜¯åœ¨ Linux ä¸Šè¿è¡Œè¦ç”¨çš„ï¼ŒæŒ‡å®šæ‰§è¡Œè¿™ä¸ªä»£ç çš„ç¨‹åºè·¯å¾„ã€‚è¿™è¡Œä¸€åŠ ï¼Œçœ‹èµ·æ¥ä»£ç æ²¡å•¥å˜åŒ–ï¼Œç»“æœ Windows ä¸ŠåŒå‡»è¿è¡Œä¸èµ·æ¥äº†ï¼ŒæŒ‰è¯´æ˜¯è¡Œæ³¨é‡Šå§ï¼Œä½†æ˜¯åŒå‡»ä¹‹åå°±æ˜¯é—ªé€€ã€‚ä½ ä»¬ Linux çœŸçš„æ˜¯ï¼ˆæŒ‡æŒ‡ç‚¹ç‚¹ï¼‰ã€‚</p>
  <details>
  <summary>å±•å¼€æŸ¥çœ‹æ·»åŠ çš„ shebang</summary>
<pre><code class="language-python">#!/usr/bin/env python3
</code></pre>
  </details>
</li>
<li>
<p>é‚£è¡Œå§ï¼Œä¸ºäº†ç…§é¡¾ Linux ç”¨æˆ·ï¼Œè¿™ shebang å°±ç•™ç€äº†ã€‚é‚£ Windows æ€ä¹ˆåŠï¼Ÿæˆ‘åŠ äº†ä¸€ä¸ª <code>bat</code> æ–‡ä»¶ï¼ŒåŒå‡»è¿™ä¸ª <code>bat</code> æ–‡ä»¶å°±èƒ½æ­£å¸¸è¿è¡Œäº†ã€‚</p>
  <details>
  <summary>å±•å¼€æŸ¥çœ‹æ·»åŠ çš„ windows_run.bat æ–‡ä»¶</summary>
<pre><code class="language-bat">@echo off
python XDUClassVideoDownloader.py %*
pause
</code></pre>
  </details>
</li>
<li>
<p>éå¸¸ç¾ä¸½è„šæœ¬ï¼Œè¿™ä½¿æˆ‘çš„è¿è¡Œç¯å¢ƒæ—‹è½¬ã€‚æˆ‘çªç„¶è§‰å¾—æ¯ä¸ªç”¨æˆ·åœ¨ä½¿ç”¨ä¹‹å‰éƒ½ç…§ç€ Readme é…ä¸€éè¿è¡Œç¯å¢ƒä¹Ÿå¤ªéº»çƒ¦äº†ï¼Œè€Œä¸”å¯¹å°ç™½ç”¨æˆ·æ¥è¯´ä¹Ÿä¸å‹å¥½ï¼Œäºæ˜¯æƒ³åˆ°äº†æŠŠè¿è¡Œç¯å¢ƒæ‰“åŒ…è¿›å»ï¼Œè¿™æ ·ç”¨æˆ·åªéœ€è¦ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶å°±èƒ½ç›´æ¥è¿è¡Œäº†ã€‚ä½¿ç”¨ <code>pyinstaller</code> æ‰“åŒ…ä¹‹åå°±èƒ½å¾—åˆ°ä¸€ä¸ª <code>XDUClassVideoDownloader.exe</code> æ–‡ä»¶ï¼Œä¸ç”¨é…ç¯å¢ƒï¼ŒåŒå‡»å°±èƒ½è¿è¡Œäº†ã€‚</p>
  <details>
  <summary>å±•å¼€æŸ¥çœ‹æ‰“åŒ…å‘½ä»¤</summary>
<pre><code class="language-shell">pip install pyinstaller
python -m venv .venv
.venv\Scripts\activate
pip install requests tqdm
pyinstaller --onefile --add-data &#34;N_m3u8DL-RE.exe;.&#34; --add-data &#34;ffmpeg.exe;.&#34; XDUClassVideoDownloader.py
</code></pre>
  </details>
</li>
<li>
<p>æ‰“åŒ…ç”¨çš„è„šæœ¬æœ€åéœ€è¦æ·»åŠ ä¸€è¡Œï¼Œä½¿å®ƒåœ¨æ‰§è¡Œç»“æŸä¹‹åä¸ä¼šè‡ªå·±å…³é—­çª—å£ï¼Œç­‰æŒ‰å›è½¦ä¹‹åæ‰ä¼šå…³é—­ã€‚</p>
  <details>
  <summary>å±•å¼€æŸ¥çœ‹ç­‰å¾…è¾“å…¥çš„ä»£ç </summary>
<pre><code class="language-python">input(&#34;æŒ‰å›è½¦é€€å‡º...&#34;)
</code></pre>
  </details>
</li>
<li>
<p>å› ä¸ºæ·»åŠ äº† FFmpeg è¿™ä¸ªåºç„¶å¤§ç‰©ï¼Œæ‰“åŒ…ä¹‹åçš„ exe æ–‡ä»¶æœ‰å¥½å‡ å MBï¼Œè¿™å¯å¤ªå¤§äº†ã€‚ä½†æ˜¯ <code>N_m3u8DL-RE</code> éœ€è¦ FFmpegï¼Œæ‰§è¡Œçš„æ—¶å€™ä¼šæ£€æµ‹ FFmpeg æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±ä¸èƒ½æ­£å¸¸ç”¨äº†ã€‚æˆ‘è¿˜å°è¯•æŠŠ FFmpeg ä» <a rel="noopener noreferrer" href="https://github.com/BtbN/FFmpeg-Builds/releases">BtbN</a> ç¼–è¯‘çš„ç‰ˆæœ¬æ¢æˆäº† <a rel="noopener noreferrer" href="https://www.gyan.dev/ffmpeg/builds/">gyan.dev</a> ç¼–è¯‘çš„ essentials ç‰ˆæœ¬ï¼Œä½†æ˜¯æ‰“åŒ…ä½“ç§¯ä¹Ÿå°±ç¨å¾®å°äº†ä¸€ç‚¹ï¼Œå‡†ç¡®æ¥è¯´æ˜¯ä» 58.5 MB å‡å°åˆ°äº† 43.9 MBï¼Œè‡³å°‘æ˜¯ä¸ªè¿›æ­¥å§ã€‚</p>
</li>
<li>
<p>ç„¶åæˆ‘åˆè½¬å¿µä¸€æƒ³ï¼Œè¿™ä¸å¯¹åŠ²ã€‚æˆ‘åœ¨ <code>N_m3u8DL-RE</code> çš„å‘½ä»¤è¡Œå‚æ•°é‡ŒæŒ‡å®šäº†ä½¿ç”¨äºŒè¿›åˆ¶åˆå¹¶æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯æŠŠä¸‹è½½çš„åˆ†æ®µ ts æ–‡ä»¶ç›´æ¥æŒ‰ç…§äºŒè¿›åˆ¶ç¼–ç æ‹¼æ¥èµ·æ¥ï¼Œç†è®ºä¸Šæ²¡æœ‰ç”¨åˆ° <code>FFmpeg</code> é‡æ–°å°è£…ã€‚äºæ˜¯æˆ‘æƒ³å‡ºäº†ä¸€ä¸ªç¥å¥‡çš„ç³Šå¼„æ–¹æ¡ˆï¼šæˆ‘ç”¨ c å†™äº†ä¸ªä»€ä¹ˆç”¨éƒ½æ²¡æœ‰çš„ç¨‹åºï¼Œç¼–è¯‘æˆ <code>exe</code> æ–‡ä»¶ï¼Œæ”¹åæˆ <code>FFmpeg.exe</code> æ”¾åˆ°æ–‡ä»¶å¤¹é‡Œã€‚è¿™æ · <code>N_m3u8DL-RE</code> å°±èƒ½æ£€æµ‹åˆ° <code>FFmpeg</code> äº†ï¼Œä½†æ˜¯å®é™…ä¸Šå¹¶æ²¡æœ‰ç”¨åˆ° <code>FFmpeg</code>ã€‚è¿™ä¸ªç¨‹åºçš„ä»£ç å¦‚ä¸‹ï¼š</p>
  <details>
  <summary>å±•å¼€æŸ¥çœ‹ä»€ä¹ˆç”¨éƒ½æ²¡æœ‰çš„ä»£ç </summary>
<pre><code class="language-c">int main() {
    return 0;
}
</code></pre>
<p>æ²¡ç”¨çš„ä»£ç ä½ ä¹Ÿçœ‹ï¼ŸğŸ˜ </p>
  </details>
</li>
<li>
<p>ä»€ä¹ˆç”¨éƒ½æ²¡æœ‰çš„ <code>FFmpeg.exe</code> ç¼–è¯‘å‡ºæ¥æ˜¯ 15 KBï¼Œæ¢ä¸Šå» <code>N_m3u8DL-RE</code> ç¡®å®èƒ½æ­£å¸¸è¿è¡Œã€‚ä½†æˆ‘è¿˜æ˜¯ä¸æ»¡æ„ã€‚ç„¶åæˆ‘çªç„¶æƒ³åˆ°å¯ä»¥ç”¨ <a rel="noopener noreferrer" href="https://github.com/upx/upx"><code>UPX</code></a> å‹ç¼© <code>exe</code>ã€‚ç»“æœæ˜¯ 8 KBã€‚å—¯ï¼Œæ»¡æ„äº†ã€‚æ›¿æ¢æ‰åŸæ¥çš„ <code>FFmpeg.exe</code>ï¼Œæ‰“åŒ…ä¹‹åçš„ <code>exe</code> ä» 43.9 MB å‡å°åˆ°äº† 14.4 MBã€‚</p>
  <details>
  <summary>å±•å¼€æŸ¥çœ‹ä½¿ç”¨ UPX å‹ç¼©çš„å‘½ä»¤</summary>
<pre><code class="language-shell">upx --ultra-brute ffmpeg.exe
</code></pre>
  </details>
</li>
<li>
<p><code>N_m3u8DL-RE</code> è°ƒç”¨ FFmpeg çš„æ—¶å€™å¦‚æœ FFmpeg ä¸åœ¨ <code>Path</code> ä¸­ä¼šæ‰¾ä¸åˆ°ã€‚ä½†å®ƒä¹Ÿæä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•° <code>--ffmpeg-binary-path &lt;PATH&gt;</code> æ¥æŒ‡å®š FFmpeg çš„è·¯å¾„ã€‚</p>
  <details>
  <summary>å±•å¼€æŸ¥çœ‹æ·»åŠ  FFmpeg è·¯å¾„å‚æ•°çš„ä»£ç </summary>
<pre><code class="language-python">def resource_path(relative_path):
    base_path = getattr(sys, &#39;_MEIPASS&#39;, os.path.dirname(os.path.abspath(__file__)))
    return os.path.join(base_path, relative_path)

def download_m3u8(url, filename, save_dir, command=&#39;&#39;):
    n_m3u8dl_re_path = resource_path(&#39;N_m3u8DL-RE.exe&#39;)
    ffmpeg_path = resource_path(&#39;ffmpeg.exe&#39;)

    if not command:
        command = f&#39;./{n_m3u8dl_re_path} &#34;{url}&#34; --save-dir &#34;{save_dir}&#34; --save-name &#34;{filename}&#34; --check-segments-count False --binary-merge True --ffmpeg-binary-path &#34;{ffmpeg_path}&#34;&#39;
    else:
        command = command.format(url=url, filename=filename, save_dir=save_dir, ffmpeg_path=ffmpeg_path)
......
</code></pre>
  </details>
</li>
<li>
<p>è¿™æ—¶å€™ç¾¤å‹å‘æˆ‘æ¨èäº†å¦ä¸€ä¸ª m3u8 ä¸‹è½½å™¨ <a rel="noopener noreferrer" href="https://github.com/clitic/vsd">vsd</a>ã€‚å®ƒæ˜¯ç”¨ <code>Rust</code> å†™çš„ <del>ï¼ˆæˆ‘è¶…ï¼ŒåŸï¼ï¼‰</del> ã€‚å®ƒçš„äºŒè¿›åˆ¶åˆå¹¶æ¨¡å¼ä¸éœ€è¦ FFmpegã€‚æˆ‘è¯•äº†ä¸€ä¸‹ï¼Œæ„Ÿè§‰ä½“éªŒä¸é”™ï¼Œäºæ˜¯æ¢æˆäº†è¿™ä¸ªã€‚å®ƒçš„äºŒè¿›åˆ¶æ–‡ä»¶æ¯” <code>N_m3u8DL-RE</code> å¤§ä¸€ç‚¹ï¼Œä½†æ˜¯æˆ‘å‘ç°å®ƒæ²¡æœ‰ç»è¿‡å‹ç¼©ï¼Œäºæ˜¯ç”¨ <code>UPX</code> å‹ç¼©äº†ä¸€ä¸‹ï¼Œä½“ç§¯ä» 13.3 MB å‡å°åˆ°äº† 3.5 MBï¼Œæ‰“åŒ…ä½“ç§¯ 11.9 MBã€‚</p>
  <details>
  <summary>å±•å¼€æŸ¥çœ‹ä½¿ç”¨ vsd ä¸‹è½½è§†é¢‘çš„ä»£ç </summary>
<pre><code class="language-python">command = f&#39;vsd-upx.exe save {url} -o {save_dir}\{filename} --retry-count 32 -t 16&#39;
</code></pre>
  </details>
</li>
<li>
<p>æ¢æˆ <code>vsd</code> ä¹‹åï¼Œæœ‰ä¸€ä¸ªåŠŸèƒ½ä¹Ÿå¯ä»¥å®ç°äº†ï¼Œé‚£å°±æ˜¯ä¸‹è½½è§†é¢‘ä¹‹åè‡ªåŠ¨åˆå¹¶ä¸Šä¸‹åŠèŠ‚è¯¾ã€‚å½•ç›´æ’­å¹³å°çš„è§†é¢‘æ˜¯ä¸Šä¸‹åŠèŠ‚è¯¾åˆ†å¼€çš„ï¼Œä½†è¿™ä¸¤æ®µè§†é¢‘åœ¨æ—¶é—´ä¸Šæ˜¯è¿ç»­çš„ï¼Œåˆå¹¶åœ¨ä¸€èµ·æ›´æ–¹ä¾¿çœ‹ï¼Œä¹Ÿæ–¹ä¾¿æ•´ç†ã€‚äºæ˜¯ä½¿ç”¨ <code>vsd</code> çš„ <code>merge</code> å‚æ•°å®ç°äº†è¿™ä¸ªåŠŸèƒ½ã€‚</p>
  <details>
  <summary>å±•å¼€æŸ¥çœ‹åˆå¹¶è§†é¢‘çš„å‡½æ•°ï¼ˆå› ä¸ºè¿™ä¸ªåŠŸèƒ½å¯ä»¥å¼€å…³æ‰€ä»¥ä»£ç é‡Œåˆ°å¤„éƒ½æ”¹äº†ä¸€ç‚¹ç‚¹ï¼Œå°±ä¸å…¨éƒ¨æ”¾ä¸Šæ¥äº†ï¼‰</summary>
<pre><code class="language-python">def merge_videos(files, output_file):
    if sys.platform.startswith(&#39;win32&#39;):
        command = f&#39;vsd-upx.exe merge -o {output_file} {&#34; &#34;.join(files)}&#39;
    else:
        command = f&#39;./vsd-upx merge -o {output_file} {&#34; &#34;.join(files)}&#39;

    try:
        subprocess.run(command, shell=True, check=True)
        print(f&#34;åˆå¹¶å®Œæˆï¼š{output_file}&#34;)
        for file in files:
            os.remove(file)
    except subprocess.CalledProcessError:
        print(f&#34;åˆå¹¶ {output_file} å¤±è´¥ï¼š\n{traceback.format_exc()}&#34;)
</code></pre>
  </details>
</li>
<li>
<p>æ·»åŠ åˆå¹¶è§†é¢‘åŠŸèƒ½æ¶‰åŠåˆ°äº†ä¸€å¤§å †é€»è¾‘æ”¹åŠ¨ã€‚</p>
<ul>
<li>
<p>å‘½åçš„æ—¶å€™ï¼Œæ¯”å¦‚åˆå¹¶å‰æ–‡ä»¶åæ˜¯ <code>xxxç¬¬5èŠ‚xxx</code> å’Œ <code>xxxç¬¬6èŠ‚xxx</code>ï¼Œåˆå¹¶åçš„æ–‡ä»¶åå°±å«ä½œ <code>xxxç¬¬5-6èŠ‚xxx</code>ï¼Œæ–‡ä»¶åçš„å…¶ä»–éƒ¨åˆ†ä¿æŒä¸å˜ã€‚</p>
</li>
<li>
<p>åˆå¹¶çš„æ—¶å€™è€ƒè™‘åˆ°æœ‰äº›æ—¶å€™æ•°æ®æºä¼šä¸¢å¤±å‡ æ¡è§†é¢‘æ•°æ®ï¼Œè¦æ­£ç¡®å¤„ç†è§†é¢‘é“¾æ¥æˆ–è€…è§†é¢‘æ–‡ä»¶ä¸å­˜åœ¨çš„é”™è¯¯ï¼Œå¦‚æœæ— æ³•ä¸‹è½½ä¸Šä¸‹ä¸¤ä¸ªåŠèŠ‚è¯¾æˆ–è€…å…¶ä¸­ä¸€ä¸ªåŠèŠ‚è¯¾å°±è·³è¿‡åˆå¹¶ã€‚</p>
</li>
<li>
<p>åœ¨åˆ¤æ–­è§†é¢‘æ˜¯å¦å­˜åœ¨çš„é€»è¾‘ä¸­åŠ å…¥æ£€æŸ¥åˆå¹¶äº†çš„æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯:</p>
<ul>
<li>å¦‚æœä¸Šä¸‹åŠèŠ‚åˆå¹¶çš„è§†é¢‘å­˜åœ¨å°±è·³è¿‡ä¸‹è½½ä¸Šä¸‹åŠèŠ‚è¯¾</li>
<li>å¦‚æœä¸Šä¸‹åŠèŠ‚æ²¡æœ‰åˆå¹¶çš„ä¸¤ä¸ªè§†é¢‘éƒ½å­˜åœ¨å°±å°è¯•åˆå¹¶</li>
<li>å¦‚æœåªå­˜åœ¨å…¶ä¸­åŠèŠ‚å°±å°è¯•ä¸‹è½½å¦å¤–åŠèŠ‚å¹¶ä¸”å¦‚æœä¸‹è½½æˆåŠŸå°±å°è¯•åˆå¹¶</li>
</ul>
</li>
<li>
<p>åˆå¹¶æˆåŠŸååˆ é™¤åˆå¹¶å‰çš„å•ä¸ªè§†é¢‘æ–‡ä»¶ã€‚</p>
</li>
<li>
<p>è¿™ä¸ªåˆå¹¶è§†é¢‘çš„åŠŸèƒ½ä½œä¸ºå¯é€‰é¡¹åœ¨äº¤äº’å¼æ“ä½œå’Œå‘½ä»¤è¡Œä½¿ç”¨ä¸­éƒ½æä¾›ï¼Œé»˜è®¤åˆå¹¶ã€‚</p>
</li>
<li>
<p>é€‰æ‹©ä¸åˆå¹¶çš„å‘½ä»¤è¡Œå‚æ•°ä¸º <code>--no-merge</code>ã€‚</p>
</li>
<li>
<p>ä¸åˆå¹¶çš„è¯ä¸Šé¢æè¿°çš„é€»è¾‘éƒ½ä¸ç”Ÿæ•ˆï¼Œæ•ˆæœå’Œä¹‹å‰çš„ä»£ç ä¿æŒç›¸åŒã€‚</p>
</li>
<li>
<p>åœ¨äº¤äº’æ¨¡å¼ä¸­ï¼Œå¦‚æœé€‰æ‹©åªä¸‹è½½åŠèŠ‚è¯¾è§†é¢‘ï¼Œå°±ä¸è¯¢é—®æ˜¯å¦åˆå¹¶ï¼Œä¹Ÿä¸æ‰§è¡Œåˆå¹¶åŠŸèƒ½ã€‚</p>
<details>
<summary>å±•å¼€æŸ¥çœ‹ä¿®æ”¹åçš„ main å‡½æ•°ï¼Œè¿™ç®€ç›´æ˜¯ä¸€å¤§å¨ï¼Œå¸Œæœ›é€»è¾‘ä¸Šæ²¡å‡ºé”™</summary>
<pre><code class="language-python">def main(liveid=None, command=&#39;&#39;, single=0, merge=True):
    if not liveid:
        liveid = int(user_input_with_check(
            &#34;è¯·è¾“å…¥ liveIdï¼š&#34;,
            lambda liveid: liveid.isdigit() and len(liveid) &lt;= 10
        ))

        single = user_input_with_check(
            &#34;æ˜¯å¦ä»…ä¸‹è½½å•èŠ‚è¯¾è§†é¢‘ï¼Ÿè¾“å…¥ y ä¸‹è½½å•èŠ‚è¯¾ï¼Œn ä¸‹è½½è¿™é—¨è¯¾æ‰€æœ‰è§†é¢‘ï¼Œs åˆ™ä»…ä¸‹è½½å•é›†ï¼ˆåŠèŠ‚è¯¾ï¼‰è§†é¢‘ï¼Œç›´æ¥å›è½¦é»˜è®¤å•èŠ‚è¯¾ (Y/n/s):&#34;,
            lambda single: single.lower() in [&#39;&#39;, &#39;y&#39;, &#39;n&#39;, &#39;s&#39;]
        ).lower()
        if single in [&#39;&#39;, &#39;y&#39;]:
            single = 1
        elif single == &#39;s&#39;:
            single = 2
        else:
            single = 0

        if single != 2:
            merge = user_input_with_check(
                &#34;æ˜¯å¦è‡ªåŠ¨åˆå¹¶ä¸Šä¸‹åŠèŠ‚è¯¾è§†é¢‘ï¼Ÿè¾“å…¥ y åˆå¹¶ï¼Œn ä¸åˆå¹¶ï¼Œç›´æ¥å›è½¦é»˜è®¤åˆå¹¶ (Y/n):&#34;,
                lambda merge: merge.lower() in [&#39;&#39;, &#39;y&#39;, &#39;n&#39;]
            ).lower() != &#39;n&#39;
    else:
        if single &gt; 2:
            single = 2

    data = get_initial_data(liveid)

    if not data:
        print(&#34;æ²¡æœ‰æ‰¾åˆ°æ•°æ®ï¼Œè¯·æ£€æŸ¥ liveId æ˜¯å¦æ­£ç¡®ã€‚&#34;)
        return

    if single:
        matching_entry = next(
            filter(lambda entry: entry[&#34;id&#34;] == liveid, data))

        if not matching_entry:
            raise ValueError(&#34;No matching entry found for the specified liveId&#34;)

        if single == 1:
            start_time = matching_entry[&#34;startTime&#34;]
            data = list(filter(
                lambda entry: entry[&#34;startTime&#34;][&#34;date&#34;] == start_time[&#34;date&#34;] and
                entry[&#34;startTime&#34;][&#34;month&#34;] == start_time[&#34;month&#34;],
                data))
        else:
            data = [matching_entry]

    first_entry = data[0]
    start_time = first_entry[&#34;startTime&#34;][&#34;time&#34;]
    course_code = first_entry[&#34;courseCode&#34;]
    course_name = first_entry[&#34;courseName&#34;]

    start_time_unix = start_time / 1000
    start_time_struct = time.gmtime(start_time_unix)
    year = start_time_struct.tm_year

    save_dir = f&#34;{year}å¹´{course_code}{course_name}&#34;
    os.makedirs(save_dir, exist_ok=True)

    csv_filename = f&#34;{year}å¹´{course_code}{course_name}.csv&#34;

    rows = []
    for entry in tqdm(data, desc=&#34;è·å–è§†é¢‘é“¾æ¥&#34;):
        live_id = entry[&#34;id&#34;]
        days = entry[&#34;days&#34;]
        day = entry[&#34;startTime&#34;][&#34;day&#34;]
        jie = entry[&#34;jie&#34;]

        start_time = entry[&#34;startTime&#34;][&#34;time&#34;]
        start_time_unix = start_time / 1000
        start_time_struct = time.gmtime(start_time_unix)
        month = start_time_struct.tm_mon
        date = start_time_struct.tm_mday

        ppt_video, teacher_track = get_m3u8_links(live_id)

        row = [month, date, day, jie, days, ppt_video, teacher_track]
        rows.append(row)

    with open(csv_filename, mode=&#39;w&#39;, newline=&#39;&#39;) as file:
        writer = csv.writer(file)
        writer.writerow([&#39;month&#39;, &#39;date&#39;, &#39;day&#39;, &#39;jie&#39;, &#39;days&#39;, &#39;pptVideo&#39;, &#39;teacherTrack&#39;])
        writer.writerows(rows)

    print(f&#34;{csv_filename} æ–‡ä»¶å·²åˆ›å»ºå¹¶å†™å…¥æ•°æ®ã€‚&#34;)

    def process_rows(rows):
        for i in range(0, len(rows), 2):
            row1 = rows[i]
            month1, date1, day1, jie1, days1, ppt_video1, teacher_track1 = row1
            day_chinese1 = day_to_chinese(day1)

            row2 = rows[i + 1] if i + 1 &lt; len(rows) else None
            if row2:
                month2, date2, day2, jie2, days2, ppt_video2, teacher_track2 = row2
                day_chinese2 = day_to_chinese(day2)

            ppt_video_files = []
            if ppt_video1:
                filename1 = f&#34;{course_code}{course_name}{year}å¹´{month1}æœˆ{date1}æ—¥ç¬¬{days1}å‘¨æ˜ŸæœŸ{day_chinese1}ç¬¬{jie1}èŠ‚-pptVideo.ts&#34;
                filepath1 = os.path.join(save_dir, filename1)
                if not os.path.exists(filepath1):
                    download_m3u8(ppt_video1, filename1, save_dir, command=command)
                ppt_video_files.append(filepath1)

            if ppt_video2:
                filename2 = f&#34;{course_code}{course_name}{year}å¹´{month2}æœˆ{date2}æ—¥ç¬¬{days2}å‘¨æ˜ŸæœŸ{day_chinese2}ç¬¬{jie2}èŠ‚-pptVideo.ts&#34;
                filepath2 = os.path.join(save_dir, filename2)
                if not os.path.exists(filepath2):
                    download_m3u8(ppt_video2, filename2, save_dir, command=command)
                ppt_video_files.append(filepath2)

            if len(ppt_video_files) == 2 and merge:
                ppt_merged_filename = f&#34;{course_code}{course_name}{year}å¹´{month1}æœˆ{date1}æ—¥ç¬¬{days1}å‘¨æ˜ŸæœŸ{day_chinese1}ç¬¬{jie1}-{jie2}èŠ‚-pptVideo.ts&#34;
                ppt_merged_filepath = os.path.join(save_dir, ppt_merged_filename)
                merge_videos(ppt_video_files, ppt_merged_filepath)

            teacher_track_files = []
            if teacher_track1:
                filename1 = f&#34;{course_code}{course_name}{year}å¹´{month1}æœˆ{date1}æ—¥ç¬¬{days1}å‘¨æ˜ŸæœŸ{day_chinese1}ç¬¬{jie1}èŠ‚-teacherTrack.ts&#34;
                filepath1 = os.path.join(save_dir, filename1)
                if not os.path.exists(filepath1):
                    download_m3u8(teacher_track1, filename1, save_dir, command=command)
                teacher_track_files.append(filepath1)

            if teacher_track2:
                filename2 = f&#34;{course_code}{course_name}{year}å¹´{month2}æœˆ{date2}æ—¥ç¬¬{days2}å‘¨æ˜ŸæœŸ{day_chinese2}ç¬¬{jie2}èŠ‚-teacherTrack.ts&#34;
                filepath2 = os.path.join(save_dir, filename2)
                if not os.path.exists(filepath2):
                    download_m3u8(teacher_track2, filename2, save_dir, command=command)
                teacher_track_files.append(filepath2)

            if len(teacher_track_files) == 2 and merge:
                teacher_merged_filename = f&#34;{course_code}{course_name}{year}å¹´{month1}æœˆ{date1}æ—¥ç¬¬{days1}å‘¨æ˜ŸæœŸ{day_chinese1}ç¬¬{jie1}-{jie2}èŠ‚-teacherTrack.ts&#34;
                teacher_merged_filepath = os.path.join(save_dir, teacher_merged_filename)
                merge_videos(teacher_track_files, teacher_merged_filepath)

    if single == 1:
        process_rows(rows[:2])
    elif single == 2:
        row = rows[0]
        month, date, day, jie, days, ppt_video, teacher_track = row
        day_chinese = day_to_chinese(day)

        if ppt_video:
            filename = f&#34;{course_code}{course_name}{year}å¹´{month}æœˆ{date}æ—¥ç¬¬{days}å‘¨æ˜ŸæœŸ{day_chinese}ç¬¬{jie}èŠ‚-pptVideo.ts&#34;
            filepath = os.path.join(save_dir, filename)
            if not os.path.exists(filepath):
                download_m3u8(ppt_video, filename, save_dir, command=command)

        if teacher_track:
            filename = f&#34;{course_code}{course_name}{year}å¹´{month}æœˆ{date}æ—¥ç¬¬{days}å‘¨æ˜ŸæœŸ{day_chinese}ç¬¬{jie}èŠ‚-teacherTrack.ts&#34;
            filepath = os.path.join(save_dir, filename)
            if not os.path.exists(filepath):
                download_m3u8(teacher_track, filename, save_dir, command=command)

    else:
        process_rows(rows)

    print(&#34;æ‰€æœ‰è§†é¢‘ä¸‹è½½å’Œå¤„ç†å®Œæˆã€‚&#34;)
</code></pre>
</details>
</li>
</ul>
</li>
<li>
<p>å‡ ç™¾è¡Œä»£ç å¥½é•¿ï¼Œæˆ‘å°å°çš„è„‘å­è¦çœ‹ä¸è¿‡æ¥äº†ï¼Œäºæ˜¯æˆ‘æŠŠä»£ç æ‹†åˆ†æˆäº†å‡ ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ <code>XDUClassVideoDownloader.py</code>ã€<code>downloader.py</code>ã€<code>api.py</code>ã€<code>utils.py</code>ã€‚è¿™æ ·ä»£ç ç»“æ„æ›´æ¸…æ™°ï¼Œä¹Ÿæ–¹ä¾¿ç»´æŠ¤ã€‚</p>
  <details>
  <summary>XDUClassVideoDownloader.pyï¼šä¸»ç¨‹åºï¼Œç”¨æˆ·äº¤äº’å’Œå‘½ä»¤è¡Œå‚æ•°è§£æ</summary>
<pre><code class="language-python">#!/usr/bin/env python3

import os
import csv
import time
from argparse import ArgumentParser
from tqdm import tqdm
import traceback
from utils import day_to_chinese, user_input_with_check, create_directory
from downloader import download_m3u8, merge_videos
from api import get_initial_data, get_m3u8_links

def main(liveid=None, command=&#39;&#39;, single=0, merge=True):
    if liveid and not isinstance(liveid, int):
        liveid = int(liveid)
    elif not liveid:
        liveid = int(user_input_with_check(
            &#34;è¯·è¾“å…¥ liveIdï¼š&#34;,
            lambda liveid: liveid.isdigit() and len(liveid) &lt;= 10
        ))

        single = user_input_with_check(
            &#34;æ˜¯å¦ä»…ä¸‹è½½å•èŠ‚è¯¾è§†é¢‘ï¼Ÿè¾“å…¥ y ä¸‹è½½å•èŠ‚è¯¾ï¼Œn ä¸‹è½½è¿™é—¨è¯¾æ‰€æœ‰è§†é¢‘ï¼Œs åˆ™ä»…ä¸‹è½½å•é›†ï¼ˆåŠèŠ‚è¯¾ï¼‰è§†é¢‘ï¼Œç›´æ¥å›è½¦é»˜è®¤å•èŠ‚è¯¾ (Y/n/s):&#34;,
            lambda single: single.lower() in [&#39;&#39;, &#39;y&#39;, &#39;n&#39;, &#39;s&#39;]
        ).lower()
        if single in [&#39;&#39;, &#39;y&#39;]:
            single = 1
        elif single == &#39;s&#39;:
            single = 2
        else:
            single = 0

        if single != 2:
            merge = user_input_with_check(
                &#34;æ˜¯å¦è‡ªåŠ¨åˆå¹¶ä¸Šä¸‹åŠèŠ‚è¯¾è§†é¢‘ï¼Ÿè¾“å…¥ y åˆå¹¶ï¼Œn ä¸åˆå¹¶ï¼Œç›´æ¥å›è½¦é»˜è®¤åˆå¹¶ (Y/n):&#34;,
                lambda merge: merge.lower() in [&#39;&#39;, &#39;y&#39;, &#39;n&#39;]
            ).lower() != &#39;n&#39;
    else:
        if single &gt; 2:
            single = 2

    data = get_initial_data(liveid)

    if not data:
        print(&#34;æ²¡æœ‰æ‰¾åˆ°æ•°æ®ï¼Œè¯·æ£€æŸ¥ liveId æ˜¯å¦æ­£ç¡®ã€‚&#34;)
        return

    if single:
        matching_entry = next(
            filter(lambda entry: entry[&#34;id&#34;] == liveid, data))

        if not matching_entry:
            raise ValueError(&#34;No matching entry found for the specified liveId&#34;)

        if single == 1:
            start_time = matching_entry[&#34;startTime&#34;]
            data = list(filter(
                lambda entry: entry[&#34;startTime&#34;][&#34;date&#34;] == start_time[&#34;date&#34;] and
                entry[&#34;startTime&#34;][&#34;month&#34;] == start_time[&#34;month&#34;],
                data))
        else:
            data = [matching_entry]

    first_entry = data[0]
    start_time = first_entry[&#34;startTime&#34;][&#34;time&#34;]
    course_code = first_entry[&#34;courseCode&#34;]
    course_name = first_entry[&#34;courseName&#34;]

    start_time_unix = start_time / 1000
    start_time_struct = time.gmtime(start_time_unix)
    year = start_time_struct.tm_year

    save_dir = f&#34;{year}å¹´{course_code}{course_name}&#34;
    create_directory(save_dir)

    csv_filename = f&#34;{year}å¹´{course_code}{course_name}.csv&#34;

    rows = []
    for entry in tqdm(data, desc=&#34;è·å–è§†é¢‘é“¾æ¥&#34;):
        live_id = entry[&#34;id&#34;]
        days = entry[&#34;days&#34;]
        day = entry[&#34;startTime&#34;][&#34;day&#34;]
        jie = entry[&#34;jie&#34;]

        start_time = entry[&#34;startTime&#34;][&#34;time&#34;]
        start_time_unix = start_time / 1000
        start_time_struct = time.gmtime(start_time_unix)
        month = start_time_struct.tm_mon
        date = start_time_struct.tm_mday

        ppt_video, teacher_track = get_m3u8_links(live_id)

        row = [month, date, day, jie, days, ppt_video, teacher_track]
        rows.append(row)

    with open(csv_filename, mode=&#39;w&#39;, newline=&#39;&#39;) as file:
        writer = csv.writer(file)
        writer.writerow([&#39;month&#39;, &#39;date&#39;, &#39;day&#39;, &#39;jie&#39;, &#39;days&#39;, &#39;pptVideo&#39;, &#39;teacherTrack&#39;])
        writer.writerows(rows)

    print(f&#34;{csv_filename} æ–‡ä»¶å·²åˆ›å»ºå¹¶å†™å…¥æ•°æ®ã€‚&#34;)

    def process_rows(rows):
        for i in range(0, len(rows), 2):
            row1 = rows[i]
            month1, date1, day1, jie1, days1, ppt_video1, teacher_track1 = row1
            day_chinese1 = day_to_chinese(day1)

            row2 = rows[i + 1] if i + 1 &lt; len(rows) else None
            if row2:
                month2, date2, day2, jie2, days2, ppt_video2, teacher_track2 = row2
                day_chinese2 = day_to_chinese(day2)

            ppt_video_files = []
            if ppt_video1:
                filename1 = f&#34;{course_code}{course_name}{year}å¹´{month1}æœˆ{date1}æ—¥ç¬¬{days1}å‘¨æ˜ŸæœŸ{day_chinese1}ç¬¬{jie1}èŠ‚-pptVideo.ts&#34;
                filepath1 = os.path.join(save_dir, filename1)
                if not os.path.exists(filepath1):
                    download_m3u8(ppt_video1, filename1, save_dir, command=command)
                ppt_video_files.append(filepath1)

            if ppt_video2:
                filename2 = f&#34;{course_code}{course_name}{year}å¹´{month2}æœˆ{date2}æ—¥ç¬¬{days2}å‘¨æ˜ŸæœŸ{day_chinese2}ç¬¬{jie2}èŠ‚-pptVideo.ts&#34;
                filepath2 = os.path.join(save_dir, filename2)
                if not os.path.exists(filepath2):
                    download_m3u8(ppt_video2, filename2, save_dir, command=command)
                ppt_video_files.append(filepath2)

            if len(ppt_video_files) == 2 and merge:
                ppt_merged_filename = f&#34;{course_code}{course_name}{year}å¹´{month1}æœˆ{date1}æ—¥ç¬¬{days1}å‘¨æ˜ŸæœŸ{day_chinese1}ç¬¬{jie1}-{jie2}èŠ‚-pptVideo.ts&#34;
                ppt_merged_filepath = os.path.join(save_dir, ppt_merged_filename)
                merge_videos(ppt_video_files, ppt_merged_filepath)

            teacher_track_files = []
            if teacher_track1:
                filename1 = f&#34;{course_code}{course_name}{year}å¹´{month1}æœˆ{date1}æ—¥ç¬¬{days1}å‘¨æ˜ŸæœŸ{day_chinese1}ç¬¬{jie1}èŠ‚-teacherTrack.ts&#34;
                filepath1 = os.path.join(save_dir, filename1)
                if not os.path.exists(filepath1):
                    download_m3u8(teacher_track1, filename1, save_dir, command=command)
                teacher_track_files.append(filepath1)

            if teacher_track2:
                filename2 = f&#34;{course_code}{course_name}{year}å¹´{month2}æœˆ{date2}æ—¥ç¬¬{days2}å‘¨æ˜ŸæœŸ{day_chinese2}ç¬¬{jie2}èŠ‚-teacherTrack.ts&#34;
                filepath2 = os.path.join(save_dir, filename2)
                if not os.path.exists(filepath2):
                    download_m3u8(teacher_track2, filename2, save_dir, command=command)
                teacher_track_files.append(filepath2)

            if len(teacher_track_files) == 2 and merge:
                teacher_merged_filename = f&#34;{course_code}{course_name}{year}å¹´{month1}æœˆ{date1}æ—¥ç¬¬{days1}å‘¨æ˜ŸæœŸ{day_chinese1}ç¬¬{jie1}-{jie2}èŠ‚-teacherTrack.ts&#34;
                teacher_merged_filepath = os.path.join(save_dir, teacher_merged_filename)
                merge_videos(teacher_track_files, teacher_merged_filepath)

    if single == 1:
        process_rows(rows[:2])
    elif single == 2:
        row = rows[0]
        month, date, day, jie, days, ppt_video, teacher_track = row
        day_chinese = day_to_chinese(day)

        if ppt_video:
            filename = f&#34;{course_code}{course_name}{year}å¹´{month}æœˆ{date}æ—¥ç¬¬{days}å‘¨æ˜ŸæœŸ{day_chinese}ç¬¬{jie}èŠ‚-pptVideo.ts&#34;
            filepath = os.path.join(save_dir, filename)
            if not os.path.exists(filepath):
                download_m3u8(ppt_video, filename, save_dir, command=command)

        if teacher_track:
            filename = f&#34;{course_code}{course_name}{year}å¹´{month}æœˆ{date}æ—¥ç¬¬{days}å‘¨æ˜ŸæœŸ{day_chinese}ç¬¬{jie}èŠ‚-teacherTrack.ts&#34;
            filepath = os.path.join(save_dir, filename)
            if not os.path.exists(filepath):
                download_m3u8(teacher_track, filename, save_dir, command=command)

    else:
        process_rows(rows)

    print(&#34;æ‰€æœ‰è§†é¢‘ä¸‹è½½å’Œå¤„ç†å®Œæˆã€‚&#34;)

def parse_arguments():
    parser = ArgumentParser(description=&#34;ç”¨äºä¸‹è½½è¥¿å®‰ç”µå­ç§‘æŠ€å¤§å­¦å½•ç›´æ’­å¹³å°è¯¾ç¨‹è§†é¢‘çš„å·¥å…·&#34;)
    parser.add_argument(&#39;liveid&#39;, nargs=&#39;?&#39;, default=None, help=&#34;è¯¾ç¨‹çš„ liveIdï¼Œä¸è¾“å…¥åˆ™é‡‡ç”¨äº¤äº’å¼æ–¹å¼è·å–&#34;)
    parser.add_argument(&#39;-c&#39;, &#39;--command&#39;, default=&#39;&#39;, help=&#34;è‡ªå®šä¹‰ä¸‹è½½å‘½ä»¤ï¼Œä½¿ç”¨ {url}, {save_dir}, {filename} ä½œä¸ºæ›¿æ¢æ ‡è®°&#34;)
    parser.add_argument(&#39;-s&#39;, &#39;--single&#39;, action=&#39;count&#39;, default=0, help=&#34;ä»…ä¸‹è½½å•èŠ‚è¯¾è§†é¢‘ï¼ˆ-sï¼šå•èŠ‚è¯¾è§†é¢‘ï¼Œ-ssï¼šåŠèŠ‚è¯¾è§†é¢‘ï¼‰&#34;)
    parser.add_argument(&#39;--no-merge&#39;, action=&#39;store_false&#39;, help=&#34;ä¸åˆå¹¶ä¸Šä¸‹åŠèŠ‚è¯¾è§†é¢‘&#34;)

    return parser.parse_args()

if __name__ == &#34;__main__&#34;:
    args = parse_arguments()
    try:
        main(liveid=args.liveid, command=args.command, single=args.single, merge=args.no_merge)
    except Exception as e:
        print(f&#34;å‘ç”Ÿé”™è¯¯ï¼š{e}&#34;)
        print(traceback.format_exc())
</code></pre>
  </details>
  <details>
  <summary>downloader.pyï¼šä¸‹è½½è§†é¢‘å’Œåˆå¹¶è§†é¢‘çš„å‡½æ•°</summary>
<pre><code class="language-python">#!/usr/bin/env python3

import subprocess
import sys
import os
import traceback

def download_m3u8(url, filename, save_dir, command=&#39;&#39;):
    if not command:
        if sys.platform.startswith(&#39;win32&#39;):
            command = f&#39;vsd-upx.exe save {url} -o {save_dir}\{filename} --retry-count 32 -t 16&#39;
        else:
            command = f&#39;./vsd-upx save {url} -o {save_dir}/{filename} --retry-count 32 -t 16&#39;
    else:
        command = command.format(url=url, filename=filename, save_dir=save_dir)

    MAX_ATTEMPTS = 2

    for attempt in range(MAX_ATTEMPTS):
        try:
            subprocess.run(command, shell=True, check=True)
            break
        except subprocess.CalledProcessError:
            print(f&#34;ç¬¬ {attempt+1} æ¬¡ä¸‹è½½ {filename} å‡ºé”™ï¼š\n{traceback.format_exc()}\né‡è¯•ä¸­...&#34;)
            if attempt == MAX_ATTEMPTS - 1:
                print(f&#34;ä¸‹è½½ {filename} å¤±è´¥ã€‚&#34;)

def merge_videos(files, output_file):
    if sys.platform.startswith(&#39;win32&#39;):
        command = f&#39;vsd-upx.exe merge -o {output_file} {&#34; &#34;.join(files)}&#39;
    else:
        command = f&#39;./vsd-upx merge -o {output_file} {&#34; &#34;.join(files)}&#39;

    try:
        subprocess.run(command, shell=True, check=True)
        print(f&#34;åˆå¹¶å®Œæˆï¼š{output_file}&#34;)
        for file in files:
            os.remove(file)
    except subprocess.CalledProcessError:
        print(f&#34;åˆå¹¶ {output_file} å¤±è´¥ï¼š\n{traceback.format_exc()}&#34;)
</code></pre>
  </details>
  <details>
  <summary>api.pyï¼šè·å–è¯¾ç¨‹æ•°æ®å’Œ m3u8 é“¾æ¥çš„å‡½æ•°</summary>
<pre><code class="language-python">#!/usr/bin/env python3

import requests
import urllib.parse
import json

def get_initial_data(liveid):
    url = &#34;http://newesxidian.chaoxing.com/live/listSignleCourse&#34;
    headers = {
        &#34;User-Agent&#34;: &#34;Mozilla/5.0&#34;,
        &#34;Cookie&#34;: &#34;UID=2&#34;
    }
    data = {
        &#34;liveId&#34;: liveid
    }

    response = requests.post(url, headers=headers, data=data)
    response.raise_for_status()
    return response.json()

def get_m3u8_links(live_id):
    url = f&#34;http://newesxidian.chaoxing.com/live/getViewUrlHls?liveId={live_id}&amp;status=2&#34;
    headers = {
        &#34;User-Agent&#34;: &#34;Mozilla/5.0&#34;,
        &#34;Cookie&#34;: &#34;UID=2&#34;
    }

    response = requests.get(url, headers=headers)
    response.raise_for_status()
    response_text = response.text

    url_start = response_text.find(&#39;info=&#39;)
    if url_start == -1:
        raise ValueError(&#34;info parameter not found in the response&#34;)

    encoded_info = response_text[url_start + 5:]
    decoded_info = urllib.parse.unquote(encoded_info)
    info_json = json.loads(decoded_info)

    video_paths = info_json.get(&#39;videoPath&#39;, {})
    ppt_video = video_paths.get(&#39;pptVideo&#39;, &#39;&#39;)
    teacher_track = video_paths.get(&#39;teacherTrack&#39;, &#39;&#39;)

    return ppt_video, teacher_track
</code></pre>
  </details>
  <details>
  <summary>utils.pyï¼šä¸€äº›å·¥å…·å‡½æ•°ï¼ŒåŒ…å«æ—¥æœŸæ±‰å­—è½¬æ¢ã€è¾“å…¥æ•°æ®æ£€æŸ¥ã€ç›®å½•åˆ›å»º</summary>
<pre><code class="language-python">#!/usr/bin/env python3

import os

def day_to_chinese(day):
    days = [&#34;æ—¥&#34;, &#34;ä¸€&#34;, &#34;äºŒ&#34;, &#34;ä¸‰&#34;, &#34;å››&#34;, &#34;äº”&#34;, &#34;å…­&#34;]
    return days[day]

def user_input_with_check(prompt, check_func):
    while True:
        user_input = input(prompt)
        if check_func(user_input):
            return user_input
        else:
            print(&#34;è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼š&#34;)

def create_directory(directory):
    os.makedirs(directory, exist_ok=True)
</code></pre>
  </details>
</li>
<li>
<p>ä¸ºäº†æ–¹ä¾¿æ‰“åŒ…ç‰ˆæœ¬åŒæ­¥ä¸»åˆ†æ”¯ä»£ç ï¼Œæˆ‘æ–°å»ºäº†ä¸€ä¸ª <code>windows-pack</code> åˆ†æ”¯ï¼Œæ—¶ä¸æ—¶ rebase ä¸€ä¸‹ã€‚å’Œä¸»åˆ†æ”¯åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<code>XDUClassVideoDownloader.py</code> æœ«å°¾æ·»åŠ äº†ç­‰å¾…è¾“å…¥ï¼Œé˜²æ­¢çª—å£è‡ªå·±å…³é—­ã€‚</li>
<li>
<code>downloader.py</code> ä¸­çš„ <code>download_m3u8</code> å‡½æ•°ä½¿ç”¨ç»å¯¹è·¯å¾„è€Œä¸æ˜¯ç›¸å¯¹è·¯å¾„æ¥è°ƒç”¨ <code>vsd-upx.exe</code>ã€‚</li>
<li>
<code>utils.py</code> ä¸­å¢åŠ  <code>resource_path</code> å‡½æ•°ï¼Œç”¨äºè·å–äºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„ã€‚</li>
</ul>
</li>
</ul>
<h1><a id="content-ä½¿ç”¨æ¼”ç¤º" href="https://blog.lsy223622.com/archives/56/#content-%E4%BD%BF%E7%94%A8%E6%BC%94%E7%A4%BA" class="heading-permalink" aria-hidden="true" title="Permalink"></a>ä½¿ç”¨æ¼”ç¤º</h1>
<ul>
<li>æ‰“å¼€æœ€æ–° <a rel="noopener noreferrer" href="https://github.com/lsy223622/XDUClassVideoDownloader/releases/latest">Release</a> é¡µé¢ï¼Œä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ <code>XDUClassVideoDownloader.exe</code> æ–‡ä»¶ã€‚</li>
<li>åŒå‡»è¿è¡Œ <code>XDUClassVideoDownloader.exe</code>ï¼ŒæŒ‰ç…§æç¤ºè¾“å…¥ <code>liveId</code>ï¼Œé€‰æ‹©æ˜¯å¦ä¸‹è½½å•èŠ‚è¯¾è§†é¢‘ï¼Œé€‰æ‹©æ˜¯å¦åˆå¹¶ä¸Šä¸‹åŠèŠ‚è¯¾è§†é¢‘ã€‚</li>
<li>ç­‰å¾…ä¸‹è½½å®Œæˆï¼Œä¸‹è½½çš„è§†é¢‘åœ¨å½“å‰ç›®å½•ä¸‹çš„ <code>å¹´ä»½+è¯¾ç¨‹ä»£ç +è¯¾ç¨‹åç§°</code> æ–‡ä»¶å¤¹ä¸­ï¼Œä¸‹è½½ç”¨åˆ°çš„ m3u8 é“¾æ¥å’Œå¯¹åº”çš„è¯¾ç¨‹æ—¶é—´ä¿¡æ¯ä¿å­˜åœ¨åŒå <code>csv</code> è¡¨æ ¼ä¸­ã€‚</li>
</ul>
<p><img src="https://blog.lsy223622.com/usr/uploads/2024/07/2728612307.png" alt="2024-07-07T14:48:24.png" loading="lazy"/></p>
<h1><a id="content-å†™åœ¨åé¢" href="https://blog.lsy223622.com/archives/56/#content-%E5%86%99%E5%9C%A8%E5%90%8E%E9%9D%A2" class="heading-permalink" aria-hidden="true" title="Permalink"></a>å†™åœ¨åé¢</h1>
<ul>
<li>æœ€æ–°çš„ç‰ˆæœ¬æ˜¯ <code>v1.0.0-beta</code>ï¼Œæ„Ÿè§‰åŸºæœ¬ä¸ŠåŠŸèƒ½å®Œå–„äº†ï¼Œæ²¡å•¥éœ€è¦æ”¹çš„äº†ã€‚</li>
<li>ä»¥åè¦æ˜¯æƒ³åˆ°ä»€ä¹ˆæ–°åŠŸèƒ½å†åŠ å§ï¼Œä¸è¿‡ç°åœ¨è¿™ä¸ªç‰ˆæœ¬å·²ç»å¤Ÿç”¨äº†ã€‚</li>
<li>å¤§å®¶è¦æ˜¯æœ‰ä»€ä¹ˆé—®é¢˜æˆ–è€…å»ºè®®å¯ä»¥å‘ Issue æˆ–è€…ç›´æ¥ QQ æ‰¾æˆ‘ã€‚</li>
<li>æˆ‘ç¬¬ä¸€æ¬¡åœ¨ GitHub ä¸Šæœ‰ä¸€ä¸ªè¿™ä¹ˆå¤š Star çš„é¡¹ç›®ï¼Œå¼€å¿ƒæã€‚ğŸ˜‹</li>
<li>ç¼–äº†è¿™ä¹ˆå¤šè¯å¯çœŸæ˜¯è¾›è‹¦æˆ‘äº†å‘¢ï¼Œé‚£å°±å†™åˆ°è¿™é‡Œå§~</li>
</ul>


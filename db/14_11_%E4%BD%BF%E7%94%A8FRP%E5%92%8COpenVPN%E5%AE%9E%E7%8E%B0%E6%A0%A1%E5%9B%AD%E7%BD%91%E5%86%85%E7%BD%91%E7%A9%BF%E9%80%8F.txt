<html><head></head><body><h1 id="使用FRP和OpenVPN实现校园网内网穿透"><a href="https://blog.ksfu.top/posts/24b6/#%E4%BD%BF%E7%94%A8FRP%E5%92%8COpenVPN%E5%AE%9E%E7%8E%B0%E6%A0%A1%E5%9B%AD%E7%BD%91%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F" class="headerlink" title="使用FRP和OpenVPN实现校园网内网穿透"></a>使用FRP和OpenVPN实现校园网内网穿透</h1><p>）因为手头闲置了一台腾讯云小水管，树莓派3b也没啥任务，就准备尝试一下内网穿透校园网。（学校自己的VPN也能用。）</p><ul><li>公网云服务器：运行FRP服务端</li><li>公司内网服务器：运行FRP客户端、安装OpenVPN</li><li>手头的设备：安装OpenVPN客户端进行连接</li></ul><h2 id="参考链接"><a href="https://blog.ksfu.top/posts/24b6/#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5" class="headerlink" title="参考链接"></a>参考链接</h2><blockquote><p><a href="https://www.spacesafe.top/archives/1557">使用FRP和OpenVPN实现内网穿透 – EI_’s Blog (spacesafe.top)</a></p><p><a href="https://blog.csdn.net/kxwinxp/article/details/88428053">CentOS下搭建Frp内网穿透服务_宁静致远kioye的博客-CSDN博客_centos frp</a></p><p><a href="https://www.ywbj.cc/?p=663">VPN设置，设置OpenVPN访问公司内网，图文详细 - 运维笔记（ywbj.cc）</a></p></blockquote><h2 id="开个端口先"><a href="https://blog.ksfu.top/posts/24b6/#%E5%BC%80%E4%B8%AA%E7%AB%AF%E5%8F%A3%E5%85%88" class="headerlink" title="开个端口先"></a>开个端口先</h2><p>本次 frp 服务端监听 端口为 <strong><code>11451</code></strong></p><p>OpenVPN 使用端口为 <strong><code>21194</code></strong></p><p>所以 在腾讯云管理控制台先把这两个端口开了</p><blockquote><p>frp是一个可用于内网穿透的高性能的反向代理应用，支持tcp、udp协议，为http和https协议提供了额外的能力，且尝试性支持了点对点穿透。</p><p>FRP采用GO语言开发,支持windows linux MacOS 等多平台部署</p></blockquote><h2 id="安装-frp-服务端与客户端"><a href="https://blog.ksfu.top/posts/24b6/#%E5%AE%89%E8%A3%85-frp-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%B8%8E%E5%AE%A2%E6%88%B7%E7%AB%AF" class="headerlink" title="安装 frp 服务端与客户端"></a>安装 frp 服务端与客户端</h2><p>因为网络问题选择先下载好再上传</p><p>frp 项目地址： <a href="https://github.com/fatedier/frp/releases">Releases · fatedier/frp (github.com)</a></p><h3 id="服务端"><a href="https://blog.ksfu.top/posts/24b6/#%E6%9C%8D%E5%8A%A1%E7%AB%AF" class="headerlink" title="服务端"></a>服务端</h3><p>在云服务器上操作</p><p>找个地方解压出来，然后进入目录</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">tar</span> zxf frp_0.42.0_linux_amd64.tar.gz<span class="token builtin class-name">cd</span> frp_0.42.0_linux_amd64/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></figure><p>修改 <code>frps.ini</code> 内容如下</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>common<span class="token punctuation">]</span>bind_port <span class="token operator">=</span> <span class="token number">11451</span><span class="token comment"># 默认配置中监听的是 7000 端口，可根据自己实际情况修改。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div></figure><p>启动 frp 服务端</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./frps <span class="token parameter variable">-c</span> ./frps.ini<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><h3 id="客户端"><a href="https://blog.ksfu.top/posts/24b6/#%E5%AE%A2%E6%88%B7%E7%AB%AF" class="headerlink" title="客户端"></a>客户端</h3><p>在树莓派上操作</p><p>找个地方解压出来，然后进入目录</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">tar</span> zxf frp_0.42.0_linux_arm64.tar.gz<span class="token builtin class-name">cd</span> frp_0.42.0_linux_arm64/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></figure><p>修改 <code>frps.ini</code> 内容如下</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>common<span class="token punctuation">]</span>server_addr <span class="token operator">=</span> *.*.*.*<span class="token comment"># * 改为 FRP 服务端的公网 IP</span>server_port <span class="token operator">=</span> <span class="token number">11451</span>     <span class="token comment"># 为 FRP 服务端监听端口 上面配置端口对应</span><span class="token punctuation">[</span>vpn_test_tcp<span class="token punctuation">]</span><span class="token builtin class-name">type</span> <span class="token operator">=</span> tcp<span class="token comment">#local_ip = 127.0.0.1</span>local_port <span class="token operator">=</span> <span class="token number">1194</span>remote_port <span class="token operator">=</span> <span class="token number">21194</span><span class="token punctuation">[</span>vpn_test_udp<span class="token punctuation">]</span><span class="token builtin class-name">type</span> <span class="token operator">=</span> udp<span class="token comment">#local_ip = 127.0.0.1</span>local_port <span class="token operator">=</span> <span class="token number">1194</span>remote_port <span class="token operator">=</span> <span class="token number">21194</span><span class="token punctuation">[</span>common<span class="token punctuation">]</span><span class="token comment"># server_addr 为 FRP 服务端的公网 IP</span>server_addr <span class="token operator">=</span> *.*.*.*<span class="token comment"># server_port 为 FRP 服务端监听的端口</span>server_port <span class="token operator">=</span> <span class="token number">11451</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>启动 frp 客户端</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 先确保服务端启动了再启动客户端</span>./frpc <span class="token parameter variable">-c</span> ./frpc.ini<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></figure><p>这样 frp 服务端就可以建立一个客户端连接了</p><h3 id="设置-frp-开机自启"><a href="https://blog.ksfu.top/posts/24b6/#%E8%AE%BE%E7%BD%AE-frp-%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF" class="headerlink" title="设置 frp 开机自启"></a>设置 frp 开机自启</h3><p>客户端服务端操作大同小异</p><p><strong>注意：</strong></p><p>客户端是 <strong><code>frpc</code></strong> 和  <strong><code>frpc.ini</code></strong> </p><p>服务端是 <strong><code>frps</code></strong> 和  <strong><code>frps.ini</code></strong> </p><p>创建后台启动模版（服务端为例）</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vi</span> /etc/systemd/system/frps.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><p><code>ExecStart</code> 根据自己放 <code>frp</code> 的目录选</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span><span class="token assign-left variable">Description</span><span class="token operator">=</span>frps<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target<span class="token punctuation">[</span>Service<span class="token punctuation">]</span><span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/home/yk/frp/frps <span class="token parameter variable">-c</span> /home/yk/frp/frps.ini<span class="token punctuation">[</span>Install<span class="token punctuation">]</span><span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 启动测试</span>systemctl start frps.service<span class="token comment"># 查看启动状态</span>systemctl status frps.service<span class="token comment"># 开机自启</span>systemctl <span class="token builtin class-name">enable</span> frps.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="OpenVPN-配置"><a href="https://blog.ksfu.top/posts/24b6/#OpenVPN-%E9%85%8D%E7%BD%AE" class="headerlink" title="OpenVPN 配置"></a>OpenVPN 配置</h2><p>在树莓派上操作（与运行）</p><blockquote><p>这里使用tun模式、tcp模式，比较容易搭建。手动搭建比较繁琐，我是直接使用一键搭建脚本。</p><p>脚本地址：<a href="https://github.com/angristan/openvpn-install">https://github.com/angristan/openvpn-install</a></p></blockquote><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-O</span> https://raw.githubusercontent.com/angristan/openvpn-install/master/openvpn-install.sh<span class="token function">chmod</span> +x openvpn-install.sh<span class="token function">sudo</span> ./openvpn-install.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>因为这里我没截图，就用参考博客的图了</p><p><img src="https://blog.ksfu.top/img/posts/frp_openvpn/3.webp" alt="3"/></p><p><img src="https://blog.ksfu.top/img/posts/frp_openvpn/4.webp" alt="4"/></p><p><img src="https://blog.ksfu.top/img/posts/frp_openvpn/5.webp" alt="5"/></p><p>然后启动 OpenVPN</p><figure><div class="code-wrapper"><pre class="line-numbers language-none"><code class="language-none"># 启动测试systemctl start openvpn.service# 查看启动状态systemctl status openvpn.service# 开机自启systemctl enable openvpn.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>在安装完成后，会生成一个以刚刚命名好的ovpn文件。</p><p><img src="https://blog.ksfu.top/img/posts/frp_openvpn/6.webp" alt="6"/></p><p>把这玩意下载下来</p><p>然后用文本编辑器打开并修改一处（应该是第三行）</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">remote xxx.xxx.xxx.xxx <span class="token number">21194</span><span class="token comment">#将默认的1194端口改成FRP转发端口21194（上面FRP客户端配置文件配置的）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></figure><blockquote><p>安装完成再次运行脚本，可选择 1)添加用户 2)移除已存在的用户 3)协助软件 4)退出</p></blockquote><h2 id="进行连接"><a href="https://blog.ksfu.top/posts/24b6/#%E8%BF%9B%E8%A1%8C%E8%BF%9E%E6%8E%A5" class="headerlink" title="进行连接"></a>进行连接</h2><p>我是在手机上测试的</p><p>安装 OpenVPN 客户端，选择我们修改好的 ovpn 文件，连接</p><p>）就是速度嘛，理解万岁，看了看论坛还行<span class="carol_shuileshuile"></span></p></body></html>